# Phase 2: Regime-Aware Signal Filter
## Final Report

**Date:** 2025-12-28  
**Objective:** Build ML model to filter trades by market regime, not predict individual outcomes

---

## Executive Summary

The Regime Filter successfully improves trading performance by:
- **+7.2% Win Rate** (63.2% → 70.3%)
- **+0.14R Expectancy** (0.26R → 0.41R per trade)
- **-26% Max Drawdown** (50.7% → 24.8%)
- **+2.7 Sharpe** (4.33 → 7.06)

The filter takes only 24% of trades, avoiding the 60.9% WR trades and keeping the 70.3% WR trades.

---

## Methodology

### 1. Regime Labeling (from PWFA)
Used walk-forward performance to label historical periods:
- **FAVORABLE**: WR > 60% (May, Sep-Oct 2025)
- **UNFAVORABLE**: WR < 40% (Jan, Mar, Nov 2025)

### 2. Market Context Features
9 features describing market state (NOT pattern geometry):
- `trend_strength` (ADX)
- `vol_trend` (volatility expansion/contraction)
- `momentum_20` (20-bar price momentum)
- `atr_percentile` (current ATR vs 100-bar range)
- `price_position` (position in 50-bar range)
- `vol_trend_ratio` (volume MA 20/50)
- `rsi` (relative strength)
- `vol_ratio` (current volume vs average)
- `pattern_bullish` (pattern direction)

### 3. Model Training
- Algorithm: Gradient Boosting Classifier
- Train/Test: 70/30 time-based split
- Threshold optimization: 0.4 (best trade-off)

---

## Results

### Performance Comparison

| Metric | Unfiltered | Filtered | Change |
|--------|------------|----------|--------|
| Trades | 1,509 | 364 | -76% |
| Win Rate | 63.2% | 70.3% | **+7.2%** |
| Expectancy | +0.26R | +0.41R | **+0.14R** |
| Profit Factor | 1.71 | 2.37 | +0.66 |
| Max Drawdown | 50.7% | 24.8% | **-26%** |
| Sharpe Ratio | 4.33 | 7.06 | **+2.7** |

### Trade Selection

| Category | Count | Win Rate |
|----------|-------|----------|
| Trades Taken | 364 | 70.3% |
| Trades Skipped | 1,145 | 60.9% |

The filter correctly identifies and avoids lower-probability trades.

### Feature Importance

| Feature | Importance |
|---------|------------|
| trend_strength | 0.216 |
| vol_trend | 0.160 |
| momentum_20 | 0.148 |
| atr_percentile | 0.147 |
| price_position | 0.094 |
| vol_trend_ratio | 0.087 |
| rsi | 0.073 |
| vol_ratio | 0.069 |
| pattern_bullish | 0.006 |

**Key Insight:** Trend strength and volatility trend are the most predictive of favorable regimes.

---

## Trade-offs

### Pros
- Higher win rate and expectancy
- Significantly lower drawdown
- Better Sharpe ratio
- More consistent performance

### Cons
- Fewer trade opportunities (76% reduction)
- Lower absolute total R (148 vs 397)
- May miss some winning trades in "unfavorable" periods

---

## Recommendations

1. **Use threshold 0.4** for best balance of quality vs quantity
2. **Monitor feature importance** - trend_strength and vol_trend are key
3. **Retrain periodically** as market regimes evolve
4. **Consider position sizing** based on confidence level

---

## Model Artifacts

- Dataset: `data/regime_dataset.csv`
- Model: `models/regime_classifier.pkl`
- Threshold: 0.4

---

## Next Steps (Phase 3)

1. Implement Walk-Forward Optimization
2. Add regime-based position sizing
3. Build live signal generation pipeline
4. Create real-time monitoring dashboard

---

*Report generated by QML Trading System*

